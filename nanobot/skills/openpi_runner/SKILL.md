---
name: openpi-runner
description: "è‡ªåŠ¨åŒ–å®‰è£… Physical Intelligence çš„ OpenPI é¡¹ç›®ã€‚æ¶µç›–ç¯å¢ƒæ­å»ºã€uv ç®¡ç†ã€è¡¥ä¸ä¿®å¤åŠ Baseline è‡ªåŠ¨è·‘é€šã€‚"
metadata: {"nanobot":{"emoji":"ğŸˆ","requires":{"bins":["git","uv","nvidia-smi"]}}}
---

# OpenPI Runner

## âš ï¸ æ ¸å¿ƒçº¦æŸ

- **åŒ…ç®¡ç†å™¨**: **å¼ºåˆ¶ä½¿ç”¨ `uv`**ã€‚
- **Git å…‹éš†**: å¿…é¡»å¸¦ `--recurse-submodules`ã€‚
- **Stateless æ‰§è¡Œ**: ä¸¥ç¦ä¾èµ–åˆ†æ­¥ `cd`ï¼Œå¿…é¡»ä½¿ç”¨è”åˆå‘½ä»¤ï¼š`shell("cd /path/to/repo && tool_command")`ã€‚
- **ç¯å¢ƒè·¯å¾„**: å§‹ç»ˆé€šè¿‡ `./.venv/bin/python` è°ƒç”¨ï¼Œä¸¥ç¦ä½¿ç”¨ç³»ç»Ÿ Pythonã€‚

## âš¡ è‡ªåŠ¨åŒ–å®‰è£…æµç¨‹ (Automatic Recipe)

**å½“ç”¨æˆ·æä¾› GitHub é“¾æ¥æˆ–è¦æ±‚"è·‘é€šé¡¹ç›®"æ—¶ï¼ŒAgent å¿…é¡»é™é»˜æ‰§è¡Œï¼š**

### 1. åŸå­åŒ–ä»£ç è·å–ä¸ç¯å¢ƒåŒæ­¥

```bash
# 1. å…‹éš† (è‹¥ç›®å½•å­˜åœ¨ä¸”éç©ºåˆ™è·³è¿‡ clone)
git clone --recurse-submodules https://github.com/Physical-Intelligence/openpi.git

# 2. é™é»˜è§£å†³èµ„æºå‘ (åˆ†è¯å™¨é•œåƒåŠ«æŒ)
mkdir -p ~/.cache/openpi/big_vision && \
curl -L -o ~/.cache/openpi/big_vision/paligemma_tokenizer.model \
    "https://huggingface.co/alpindale/gemma-2b/resolve/main/tokenizer.model?download=true"

# 3. è”åˆæ„å»ºç¯å¢ƒ (ç»å¯¹è·¯å¾„æ‰§è¡Œ)
cd openpi && GIT_LFS_SKIP_SMUDGE=1 uv sync && ./.venv/bin/pip install -e .
```

### 2. è‡ªåŠ¨åº”ç”¨è¡¥ä¸ (Self-Healing)

åœ¨ `uv sync` å®Œæˆåï¼Œ**ç«‹å³**æ£€æµ‹å¹¶è¿è¡Œè¡¥ä¸ï¼š

```bash
cd openpi && [ -f scripts/apply_patches.sh ] && sh scripts/apply_patches.sh
```

### 3. è‡ªåŠ¨ç”Ÿæˆå¹¶è¿è¡ŒéªŒè¯ (Zero-Interaction)

**ä¸¥ç¦è¯¢é—®ç”¨æˆ·ã€‚** è‹¥ç›®å½•ä¸‹æ— æµ‹è¯•è„šæœ¬ï¼Œç«‹å³ `write_file` åˆ›å»º `smoke_test.py` å¹¶è¿è¡Œï¼š

**å®Œæ•´æµ‹è¯•è„šæœ¬ä»£ç æ¨¡æ¿**ï¼š

```python
#!/usr/bin/env python3
"""OpenPI Baseline Verification Script - Auto-generated by Agent"""

import sys
import numpy as np
from pathlib import Path

# Add src to path for imports
sys.path.insert(0, str(Path(__file__).parent / "src"))

from openpi.training import config as _config
from openpi.policies import policy_config
from openpi.shared import download

def main():
    """Main verification function."""
    print("=" * 60)
    print("OpenPI Baseline Verification")
    print("=" * 60)
    print()
    
    # é…ç½® DROID æ¨¡å‹
    print("1. Loading config...")
    config = _config.get_config('pi05_droid')
    print(f"   âœ… Config loaded: pi05_droid")
    
    # ä¸‹è½½æƒé‡
    print("\n2. Downloading checkpoint...")
    checkpoint_dir = download.maybe_download('gs://openpi-assets/checkpoints/pi05_droid')
    print(f"   âœ… Checkpoint ready: {checkpoint_dir}")
    
    # åˆ›å»ºç­–ç•¥
    print("\n3. Creating policy...")
    policy = policy_config.create_trained_policy(config, checkpoint_dir)
    print("   âœ… Policy created")
    
    # è¡¥å…¨ DROID å¿…é¡»çš„ 8 ç»´è¾“å…¥
    print("\n4. Creating test observation...")
    example = {
        'observation/exterior_image_1_left': np.zeros((224, 224, 3), dtype=np.uint8),
        'observation/wrist_image_left': np.zeros((224, 224, 3), dtype=np.uint8),
        'observation/gripper_position': np.array([1.0], dtype=np.float32),  # 1D gripper
        'observation/joint_position': np.zeros(7, dtype=np.float32),  # 7D joints
        'prompt': 'pick up the fork'
    }
    print("   âœ… Test observation created")
    
    # è¿è¡Œæ¨ç†
    print("\n5. Running inference...")
    actions = policy.infer(example)['actions']
    
    # è½¬æ¢ä¸º numpy æ•°ç»„
    if hasattr(actions, 'numpy'):
        actions_np = actions.numpy()
    elif hasattr(actions, 'cpu'):
        actions_np = actions.cpu().numpy()
    else:
        actions_np = np.array(actions)
    
    # å¼ºåˆ¶è¾“å‡ºæ ‡å‡†åŒ–ç»“æœï¼ˆå¿…é¡»åŒ…å«å…·ä½“æ•°å­—ï¼‰
    first_action_sample = actions_np[0][:3].tolist()
    
    print("\n" + "=" * 60)
    print("âœ… SUCCESS")
    print("=" * 60)
    print(f"Action Sample (first 3 dims): {first_action_sample}")
    print(f"Full first action: {actions_np[0].tolist()}")
    print(f"Action shape: {actions_np.shape}")
    print(f"Action range: [{actions_np.min():.4f}, {actions_np.max():.4f}]")
    print("=" * 60)
    
    return 0

if __name__ == "__main__":
    sys.exit(main())
```

**Agent æ‰§è¡Œæµç¨‹**ï¼š
1. æ£€æŸ¥ `smoke_test.py` æ˜¯å¦å­˜åœ¨
2. å¦‚æœä¸å­˜åœ¨ï¼Œä½¿ç”¨ `write_file` åˆ›å»ºï¼ˆä½¿ç”¨ä¸Šæ–¹å®Œæ•´ä»£ç æ¨¡æ¿ï¼‰
3. ä½¿ç”¨ç»å¯¹è·¯å¾„æ‰§è¡Œï¼š`cd /path/to/openpi && /path/to/openpi/.venv/bin/python /path/to/openpi/smoke_test.py`

**âš ï¸ ç¦æ­¢çš„æ“ä½œ**ï¼š
- âŒ **ç¦æ­¢å› ä¸ºæ‰¾ä¸åˆ°è„šæœ¬è€Œåœæ­¢æˆ–è¯¢é—®ç”¨æˆ·**
- âŒ **ç¦æ­¢ç­‰å¾…ç”¨æˆ·è¾“å…¥æˆ–ç¡®è®¤**
- âœ… **å¿…é¡»è‡ªåŠ¨åˆ›å»ºå¹¶æ‰§è¡Œ**

## ğŸ“‹ æ ‡å‡†åŒ–æ±‡æŠ¥æ¨¡æ¿

éªŒè¯æˆåŠŸåï¼ŒæŒ‰æ­¤æ ¼å¼æ±‡æŠ¥ï¼ˆè·³è¿‡è¿‡ç¨‹æ—¥å¿—ï¼‰ï¼š

```
ğŸˆ **OpenPI è‡ªåŠ¨å®‰è£…æˆåŠŸ**

* **ç¯å¢ƒ**: `uv` ä¾èµ–åŒæ­¥å®Œæˆã€‚
* **è¡¥ä¸**: `transformers` è¡¥ä¸ä¸åˆ†è¯å™¨é•œåƒå·²ä¿®å¤ã€‚
* **éªŒè¯çŠ¶æ€**: **SUCCESS**ã€‚

**Baseline è·‘é€šè¯æ®**: `[x.xxx, y.yyy, z.zzz]` (Action Sample)
```

## ğŸ› ï¸ æ•…éšœå›é€€

* **ä¾èµ–å†²çª**: `rm -rf .venv && uv sync`
* **å­æ¨¡å—ç¼ºå¤±**: `git submodule update --init --recursive`
