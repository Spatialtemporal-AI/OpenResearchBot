---
name: openpi-runner
description: "è‡ªåŠ¨åŒ–å®‰è£… Physical Intelligence çš„ OpenPI é¡¹ç›®ã€‚æ¶µç›–ç¯å¢ƒæ­å»ºã€uv ç®¡ç†ã€è¡¥ä¸ä¿®å¤åŠ Baseline è‡ªåŠ¨è·‘é€šã€‚"
metadata: {"nanobot":{"emoji":"ğŸˆ","requires":{"bins":["git","uv","nvidia-smi"]}}}
---

# OpenPI Runner

## âš ï¸ æ ¸å¿ƒçº¦æŸ

- **åŒ…ç®¡ç†å™¨**: **å¼ºåˆ¶ä½¿ç”¨ `uv`**ã€‚
- **Git å…‹éš†**: å¿…é¡»å¸¦ `--recurse-submodules`ã€‚
- **Stateless æ‰§è¡Œ**: å§‹ç»ˆé€šè¿‡ `./.venv/bin/python` è°ƒç”¨ã€‚
- **è·¯å¾„å‡†åˆ™**: ä¼˜å…ˆåœ¨å½“å‰å·¥ä½œç›®å½•çš„ `./openpi` æ–‡ä»¶å¤¹å†…æ“ä½œã€‚

## âš¡ è‡ªåŠ¨åŒ–å®‰è£…æµç¨‹ (Automatic Recipe)

**å½“ç”¨æˆ·è¦æ±‚"å®‰è£…"æˆ–"è¿è¡Œ OpenPI"æ—¶ï¼ŒAgent å¿…é¡»é™é»˜æ‰§è¡Œï¼š**

### 1. åŸå­åŒ–ä»£ç è·å–ä¸ç¯å¢ƒåŒæ­¥

```bash
# 1. å†²çªå¤„ç†ï¼šè‹¥ç›®å½•å·²å­˜åœ¨ä¸”éç©ºï¼Œè‡ªåŠ¨æ¸…ç†ä»¥ç¡®ä¿å…¨æ–°å®‰è£…
[ -d "openpi" ] && rm -rf openpi

# 2. é€’å½’å…‹éš†
git clone --recurse-submodules https://github.com/Physical-Intelligence/openpi.git

# 3. é™é»˜è§£å†³èµ„æºå‘ (åˆ†è¯å™¨é•œåƒåŠ«æŒ)
mkdir -p ~/.cache/openpi/big_vision && \
curl -L -o ~/.cache/openpi/big_vision/paligemma_tokenizer.model \
    "https://huggingface.co/alpindale/gemma-2b/resolve/main/tokenizer.model?download=true"

# 4. è”åˆæ„å»ºç¯å¢ƒ
cd openpi && GIT_LFS_SKIP_SMUDGE=1 uv sync && ./.venv/bin/pip install -e .
```

### 2. è‡ªåŠ¨åº”ç”¨è¡¥ä¸ (Self-Healing)

åœ¨ `uv sync` å®Œæˆåï¼Œ**ç«‹å³**æ£€æµ‹å¹¶è¿è¡Œè¡¥ä¸ï¼š

```bash
cd openpi && [ -f scripts/apply_patches.sh ] && sh scripts/apply_patches.sh
```

### 3. è‡ªåŠ¨ç”Ÿæˆå¹¶è¿è¡ŒéªŒè¯ (Zero-Interaction)

**å‡†åˆ™**: ä¸¥ç¦è¯¢é—®ç”¨æˆ·ã€‚è‹¥ `./openpi/scripts/smoke_test.py` ä¸å­˜åœ¨ï¼Œç«‹å³é€šè¿‡ `write_file` åˆ›å»ºå¹¶æ‰§è¡Œã€‚

**å®Œæ•´æµ‹è¯•è„šæœ¬ä»£ç æ¨¡æ¿ (éœ€æ³¨å…¥ `write_file`)**ï¼š

```python
#!/usr/bin/env python3
"""OpenPI Baseline Verification Script - Auto-generated by Agent"""

import sys
import numpy as np
from pathlib import Path

# ç¡®ä¿å¯¼å…¥è·¯å¾„æ­£ç¡®
repo_root = Path(__file__).parent.parent
sys.path.insert(0, str(repo_root / "src"))

from openpi.training import config as _config
from openpi.policies import policy_config
from openpi.shared import download

def main():
    print("=" * 30 + " OpenPI Verification " + "=" * 30)
    config = _config.get_config('pi05_droid')
    checkpoint_dir = download.maybe_download('gs://openpi-assets/checkpoints/pi05_droid')
    policy = policy_config.create_trained_policy(config, checkpoint_dir)
    
    # æ„é€  DROID å¿…é¡»çš„ 8 ç»´è¾“å…¥
    example = {
        'observation/exterior_image_1_left': np.zeros((224, 224, 3), dtype=np.uint8),
        'observation/wrist_image_left': np.zeros((224, 224, 3), dtype=np.uint8),
        'observation/gripper_position': np.array([1.0], dtype=np.float32),
        'observation/joint_position': np.zeros(7, dtype=np.float32),
        'prompt': 'pick up the fork'
    }
    
    actions = policy.infer(example)['actions']
    actions_np = actions.cpu().numpy() if hasattr(actions, 'cpu') else np.array(actions)
    
    print("\nâœ… SUCCESS")
    print(f"Action Sample (first 3 dims): {actions_np[0][:3].tolist()}")
    print("=" * 60)
    return 0

if __name__ == "__main__":
    sys.exit(main())
```

**æ‰§è¡Œæµç¨‹**ï¼š
ä½¿ç”¨å½“å‰ç›®å½•ä¸‹çš„è™šæ‹Ÿç¯å¢ƒæ‰§è¡Œï¼š`cd openpi && ./.venv/bin/python scripts/smoke_test.py`

## ğŸ“‹ æ ‡å‡†åŒ–æ±‡æŠ¥æ¨¡æ¿

éªŒè¯æˆåŠŸåï¼ŒæŒ‰æ­¤æ ¼å¼æ±‡æŠ¥ï¼ˆè·³è¿‡è¯¦ç»†è¿‡ç¨‹æ—¥å¿—ï¼‰ï¼š

```
ğŸˆ **OpenPI è‡ªåŠ¨å®‰è£…æˆåŠŸ**

* **ç¯å¢ƒ**: `uv` ä¾èµ–åŒæ­¥å®Œæˆ & `transformers` è¡¥ä¸å·²åº”ç”¨ã€‚
* **èµ„æºä¿®å¤**: åˆ†è¯å™¨é•œåƒå·²è¡¥å…¨ (4.1MB)ã€‚
* **éªŒè¯çŠ¶æ€**: **SUCCESS**ã€‚

**Baseline è¯æ®**: `[x.xxx, y.yyy, z.zzz]` (Action Sample)
```

## ğŸ› ï¸ æ•…éšœå›é€€

* **ä¾èµ–å†²çª**: `rm -rf .venv && uv sync`
* **å­æ¨¡å—ç¼ºå¤±**: `git submodule update --init --recursive`
