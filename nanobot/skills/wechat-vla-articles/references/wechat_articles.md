# 微信公众号文章获取指南

## 概述

微信公众号没有提供公开的 API 来获取文章列表和内容。本 skill 使用以下方法获取文章：

1. **Web Search**: 使用 `web_search` 工具搜索指定公众号的相关文章
2. **Web Fetch**: 使用 `web_fetch` 工具获取文章完整内容
3. **内容提取**: 从搜索结果和页面中提取文章信息

## 搜索策略

### 1. 构建搜索查询

使用 `scripts/wechat_query.py` 生成搜索查询：

```bash
python3 nanobot/skills/wechat-vla-articles/scripts/wechat_query.py --days 7 --queries-only
```

这会生成类似以下的查询：
- `机器之心 具身智能 最近7天`
- `量子位 vision-language-action 最近7天`
- `新智元 机器人操作 最近7天`

### 2. 使用 web_search 搜索

对每个查询使用 `web_search` 工具：

```json
{
  "query": "机器之心 具身智能 最近7天",
  "count": 10,
  "search_lang": "zh-CN"
}
```

### 3. 过滤和排序结果

从搜索结果中：
- 提取文章标题、URL、发布时间
- 识别来源公众号
- 估算热度（如果可用）

## 获取文章内容

### 使用 web_fetch

对于每篇找到的文章，使用 `web_fetch` 获取完整内容：

```json
{
  "url": "https://mp.weixin.qq.com/s/...",
  "extractMode": "markdown",
  "maxChars": 10000
}
```

### 内容提取注意事项

- 微信公众号文章页面可能需要处理 JavaScript 渲染
- 使用 `firecrawl` 或 `readability` 提取器可以提高成功率
- 某些文章可能需要登录或特殊权限

## 热度指标获取

### 挑战

微信公众号的热度指标（点赞、留言、分享）通常：
- 不直接显示在文章页面
- 需要登录后才能查看
- 可能被反爬虫机制保护

### 可能的解决方案

1. **从搜索结果估算**: 使用搜索结果的排序和相关性作为热度参考
2. **第三方服务**: 使用新榜、清博等第三方数据服务（需要 API key）
3. **页面解析**: 尝试从文章页面提取可见的指标（阅读数等）

### 热度评分公式

如果能够获取指标，使用加权评分：

```
热度评分 = 点赞数 × 0.3 + 留言数 × 0.3 + 分享数 × 0.2 + 阅读数 × 0.2
```

## 工作流程示例

### 完整流程

1. **生成查询**: `wechat_query.py --days 7 --queries-only`
2. **批量搜索**: 对每个查询使用 `web_search`
3. **去重和过滤**: 合并结果，去除重复，按日期过滤
4. **获取内容**: 对每篇文章使用 `web_fetch`
5. **提取热度**: 尝试从页面或搜索结果提取热度指标
6. **排序**: 按热度评分排序
7. **总结**: 使用 `summarize` skill 总结每篇文章

### 优化建议

- **缓存结果**: 避免重复搜索相同查询
- **批量处理**: 限制并发请求，避免触发反爬虫
- **错误处理**: 处理网络错误、页面解析失败等情况
- **增量更新**: 只获取新文章，避免重复处理

## 替代方案

如果直接搜索效果不佳，可以考虑：

1. **RSS 订阅**: 部分公众号提供 RSS 订阅（如通过 Feed43 等服务）
2. **第三方聚合**: 使用专门的内容聚合平台
3. **手动维护**: 定期手动收集文章链接，然后使用本 skill 处理

## 限制和注意事项

- 微信公众号的反爬虫机制可能限制访问频率
- 某些文章可能需要登录或特殊权限
- 搜索结果可能不完整或不准确
- 热度指标可能无法准确获取
